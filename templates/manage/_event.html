{% import "shared/_form.html" as form_components %}
{% import "shared/_icons.html" as icon_components %}
{% import "shared/_display.html" as display_components %}
{% import "shared/_manage.html" as manage_components %}

{% macro manage(user, event) -%}
<div class="panel">
    <form hx-post="/api/manage/update" hx-swap="none" hx-trigger="input delay:1s, change">
        <div class="row">
            <div class="column">
                <h5 class='has-text-center has-text-dark'>Name</h5>
                <input id='model-name' class="has-bg-light has-text-center" type="text" name="name"
                       value="{{event.name}}">
            </div>
        </div>
    </form>
    {{manage_components.dates(user, event)}}
    <div class="row has-space-around">
        <div class="column is-shrink">
            <div class="panel has-bg-muted">
                <div class="row">
                    <div class="column is-shrink is-vertically-centered">
                        <h4>Add Associated Stories</h4>
                    </div>
                    <div class="column is-vertically-centered">
                        <div class="select">
                            <select class="has-bg-white" name='storypk'
                                    hx-post="/api/event/{{event.pk}}/stories/add"
                                    hx-target="#event-stories-list"
                                    hx-select="#event-stories-list"
                                    hx-swap="outerHTML"
                                    hx-confirm="Are you sure you want to add this story to the event?">
                                <option value=""></option>
                                {%for story in event.world.stories %}
                                {% if story not in event.stories %}
                                <option value="{{story.pk}}">
                                    {{story.name}}
                                </option>
                                {% endif %}
                                {%endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="column is-full">
                    <div id="event-stories-list" class="row">
                        {% for story in event.stories %}
                        <div class="column is-2 event-story-entry" style="position: relative;">
                            {{display_components.object_display(story, type=False)}}
                            <a style='position:absolute; top:0px; right:5px;'
                               hx-post="/api/event/{{event.pk}}/stories/{{story.pk}}/delete"
                               hx-target="closest .event-story-entry" hx-swap="delete"
                               hx-confirm="Are you sure you want to remove this story from the event?">
                                <iconify-icon class="has-bg-muted" icon="mdi:remove"
                                              width="1rem"></iconify-icon>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form hx-post="/api/manage/update" hx-swap="none" hx-trigger="input delay:1s, change"
          hx-push-url='false'>
        <div class="row">
            <div class="column is-full">
                <label>Backstory</label>
                {{form_components.texteditor(user, event, "backstory")}}
            </div>
            <div class="column is-full">
                <label>Outcome</label>
                {{form_components.texteditor(user, event, "outcome")}}
            </div>
            <div class="column is-full">
                <label>Impact</label>
                {{form_components.texteditor(user, event, "impact")}}
            </div>
        </div>
    </form>
</div>
{{manage_components.image(user, event)}}
<div class="row has-space-around">
    <div class="column is-shrink">
        <button class="button is-danger" hx-post="/api/event/{{ event.pk }}/delete"
                hx-target="#page-content">
            {{icon_components.delete()}}
        </button>
    </div>
</div>
{% endmacro%}