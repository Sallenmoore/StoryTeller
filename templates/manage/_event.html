{% import "shared/_form.html" as form_components %}
{% import "shared/_icons.html" as icon_components %}
{% import "shared/_display.html" as display_components %}
{% import "shared/_manage.html" as manage_components %}

{% macro manage(user, event) -%}
<div class="callout">
    <div class="grid-x align-spaced">
        <div class="cell shrink">
            <button class="button  has-text-white"
                    hx-post="/task/generate/event/{{event.pk}}"
                    hx-target="closest .cell"
                    hx-confirm='Details can be generated from scratch, but works best if you add any required details to the Event first, such as name, brief history, or other details'>
                {{icon_components.ai(size="1rem")}}
                Generate Details
            </button>
        </div>
        <div class="cell shrink">
            <button class="button  has-text-white"
                    hx-post="/task/generate/event/{{event.pk}}/summary"
                    hx-target="closest .cell">
                {{icon_components.details(size="1rem")}}
                Generate Summary
            </button>
        </div>
        <div class="cell">
            {{event.summary | safe}}
        </div>
    </div>
</div>
<form hx-post="/api/manage/update" hx-swap="none" hx-trigger="input delay:1s, change">
    <div class="grid-x">
        <div class="cell">
            <h5 class='text-center'>Name</h5>
            <input id='model-name' class=" text-center" type="text" name="name"
                   value="{{event.name}}">
        </div>
    </div>
</form>
{{manage_components.dates(user, event)}}
<div class="grid-x align-spaced">
    <div class="cell shrink">
        <div class="callout ">
            <div class="grid-x">
                <div class="cell shrink align-center-middle">
                    <h4>Add Associated Stories</h4>
                </div>
                <div class="cell align-center-middle">
                    <div class="select">
                        <select class="has-bg-white" name='storypk'
                                hx-post="/api/event/{{event.pk}}/stories/add"
                                hx-target="#event-stories-list"
                                hx-select="#event-stories-list"
                                hx-swap="outerHTML"
                                hx-confirm="Are you sure you want to add this story to the event?">
                            <option value=""></option>
                            {%for story in event.world.stories %}
                            {% if story not in event.stories %}
                            <option value="{{story.pk}}">
                                {{story.name}}
                            </option>
                            {% endif %}
                            {%endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="cell">
                <div id="event-stories-list" class="grid-x">
                    {% for story in event.stories %}
                    <div class="cell medium-2 event-story-entry" style="position: relative;">
                        {{display_components.object_display(story, type=False)}}
                        <a style='position:absolute; top:0px; right:5px;'
                           hx-post="/api/event/{{event.pk}}/stories/{{story.pk}}/delete"
                           hx-target="closest .event-story-entry" hx-swap="delete"
                           hx-confirm="Are you sure you want to remove this story from the event?">
                            <iconify-icon icon="mdi:remove"
                                          width="1rem"></iconify-icon>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
<form hx-post="/api/manage/update" hx-swap="none" hx-trigger="input delay:1s, change"
      hx-push-url='false'>
    <div class="grid-x">
        <div class="cell">
            <label>Backstory</label>
            {{form_components.richtexteditor(user, event, "backstory")}}
        </div>
        <div class="cell">
            <label>Outcome</label>
            {{form_components.richtexteditor(user, event, "outcome")}}
        </div>
        <div class="cell">
            <label>Impact</label>
            {{form_components.richtexteditor(user, event, "impact")}}
        </div>
    </div>
</form>
</div>
{{manage_components.image(user, event)}}
<div class="grid-x align-spaced">
    <div class="cell shrink">
        <button class="button is-danger" hx-post="/api/event/{{ event.pk }}/delete"
                hx-target="#page-content">
            {{icon_components.delete()}}
        </button>
    </div>
</div>
{% endmacro%}