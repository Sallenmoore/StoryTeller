{% import "models/_episode.html" as episode_components %}
{% import "shared/_icons.html" as icon_components %}
{% import "shared/_title.html" as title_components %}
{% import "shared/_history.html" as history_components %}
{% import "shared/_stories.html" as story_components %}
{% import "shared/_display.html" as display_components %}
{% import "shared/_timeline.html" as timeline_components %}
{% import "manage/_campaign.html" as manage_campaign_components %}

{% macro index(user, campaign) -%}
{{title_components.object_title(user, campaign)}}
<div class="row">
    <div class="column is-half">
        <h4 class="has-text-dark-grey has-text-center">
            Started: {{campaign.start_date if campaign.start_date else 'TBD'}}
        </h4>
    </div>
    <div class="column is-half">
        <h4 class="has-text-dark-grey has-text-center">
            Ended: {{campaign.end_date if campaign.end_date else 'TBD'}}
        </h4>
    </div>
    <div class="column is-full">
        <div class="panel has-bg-screen has-text-justified">
            {{campaign.description | safe}}
        </div>
    </div>
    <div class="column is-full">
        <div class="panel has-bg-muted">
            <hr>
            <div class='has-text-dark  has-text-justified generated-text-lightbg'>
                {{campaign.summary | safe}}
            </div>
            <hr>
        </div>
    </div>
</div>
{%- endmacro %}

{% macro menu(user, obj) -%}
<li class="menu-anchor">
    <a href=""
       hx-get="/api/{{obj.path}}" hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/details">
        <div class="row">
            <div class="column is-shrink">
                {{icon_components.details(size="1rem")}}
            </div>
            <div class="column slide-it-in">
                <span>Details</span>
            </div>
        </div>
    </a>
</li>
<li class="menu-anchor">
    <a href=""
       hx-get="/api/{{obj.path}}/history"
       hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/history">
        <div class="row">
            <div class="column is-shrink">
                {{icon_components.history(size="1rem")}}
            </div>
            <div class="column slide-it-in">
                <span>History</span>
            </div>
        </div>
    </a>
</li>
<li class="menu-anchor">
    <a href=""
       hx-get="/api/{{obj.path}}/episodes"
       hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/episodes">
        <div class="row">
            <div class="column is-shrink">
                {{icon_components.episode(size="1rem")}}
            </div>
            <div class="column slide-it-in">
                <span>Episodes</span>
            </div>
        </div>
    </a>
</li>
<li class="menu-anchor">
    <a href=""
       hx-get="/api/{{obj.path}}/timeline"
       hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/timeline">
        <div class="row">
            <div class="column is-shrink">
                {{icon_components.timeline(size="1rem")}}
            </div>
            <div class="column slide-it-in">
                <span>Timeline</span>
            </div>
        </div>
    </a>
</li>
<li class="menu-anchor">
    <a href=""
       hx-get="/api/{{obj.path}}/graphic_novel"
       hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/graphic_novel">
        <div class="row">
            <div class="column is-shrink">
                {{icon_components.graphic_novel(size="1rem")}}
            </div>
            <div class="column slide-it-in">
                <span>Graphic Novel</span>
            </div>
        </div>
    </a>
</li>
<li class="menu-anchor">
    <a href=""
       hx-get="/api/{{obj.path}}/stories"
       hx-target="#page-content"
       hx-indicator="#request-indicator"
       hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/stories">
        <div class="row">
            <div class="column is-shrink">
                {{icon_components.story(size="1rem")}}
            </div>
            <div class="column slide-it-in">
                <span>Stories</span>
            </div>
        </div>
    </a>
</li>
{% endmacro %}

{% macro history(user, obj) -%}
{{title_components.object_title(user, obj)}}
{{history_components.history(user, obj)}}
{%- endmacro %}

{% macro associations(user, obj, associations) -%}
{{title_components.object_title(user, obj)}}

<h2 class=" has-text-secondary has-text-center is-subtitle">
    Associations</h2>
<div class="row">
    {% for o in associations %}
    <div class="column is-1 has-text-center">
        {{display_components.object_display(o, type=True)}}
    </div>
    {% endfor %}
</div>

{%- endmacro %}

{% macro episodes(user, campaign) -%}
{{title_components.object_title(user, campaign)}}
<h3 class='has-text-center'>Episodes</h3>
<div class="row">
    {% for entry in campaign.episodes %}
    <div class="column is-full">
        <div class="panel has-bg-muted">
            <div class="row" class='has-text-secondary'>
                <div class="column is-vertically-centered">
                    <a href='/episode/{{entry.pk}}'>
                        <h4 class=' has-text-dark'>{{entry.name}}</h4>
                    </a>
                </div>
                <div class="column is-shrink">
                    {% if entry.start_date %}
                    <span class='tag is-primary has-text-white'>
                        {{entry.start_date}}
                    </span>
                    {% endif %}
                </div>
                <div class="column is-shrink">
                    {{icon_components.line()}}
                </div>
                <div class="column is-shrink">
                    {% if entry.end_date %}
                    <span class='tag is-primary has-text-white'>
                        {{entry.end_date}}
                    </span>
                    {% endif %}
                </div>
                <div class="column is-full is-vertically-centered generated-text-lightbg"
                     style='font-size: 0.75rem;'>
                    <div class="panel has-bg-muted">
                        {{entry.summary | safe}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{%- endmacro %}

{% macro timeline(user, obj)%}
{{title_components.object_title(user, obj)}}
{{timeline_components.timeline(user, obj)}}
{%- endmacro %}

{% macro stories(user, obj)%}
{{title_components.object_title(user, obj)}}
{{story_components.stories(user, obj)}}
{%- endmacro %}

{% macro graphic_novel(user, obj)%}
{{title_components.object_title(user, obj)}}
<h3 class='has-text-center'>Graphic Novel</h3>
<div class="row">
    {% for entry in obj.episodes[::-1] %}
    <div class="column is-half">
        <div class="panel has-bg-muted">
            <h5 class='has-text-center'>{{entry.name}}</h5>
            {% if entry.graphic %}
            <div class='image'>
                <img src='{{entry.graphic.url()}}' alt='{{entry.name}}'>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{%- endmacro %}

{% macro manage(user, obj) -%}
{{title_components.object_title(user, obj)}}
{{ manage_campaign_components.manage(user, obj) }}
{%- endmacro %}