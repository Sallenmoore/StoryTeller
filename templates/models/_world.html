{% import "shared/_form.html" as form_components %}
{% import "shared/_display.html" as display_components %}
{% import "shared/_icons.html" as icon_components %}
{% import "shared/_history.html" as history_components %}
{% import "shared/_details.html" as details_components %}
{% import "shared/_timeline.html" as timeline_components %}
{% import "shared/_journal.html" as journal_components %}
{% import "shared/_stories.html" as stories_components %}
{% import "shared/_campaigns.html" as campaigns_components %}
{% import "shared/_associations.html" as associations_components %}
{% import "shared/_map.html" as map_components %}
{% import "shared/_jobs.html" as jobs_components %}
{% import "manage/_world.html" as manage_world_components %}
{% import "manage/_story.html" as manage_story_components %}
{% import "manage/_campaign.html" as manage_campaign_components %}
{% import "manage/_gmscreen.html" as manage_screen_components %}
{% import "shared/_title.html" as title_components %}

{% macro index(user, obj) -%}
{{history(user, obj)}}
{%- endmacro %}

{% macro menu(user, obj) -%}
    <li><a href="/{{obj.path}}/history">{{icon_components.history(size="1rem")}} History</a></li>
    <li><a href="/{{obj.path}}/timeline">{{icon_components.timeline(size="1rem")}} Timeline</a></li>
    <li><a href="/{{obj.path}}/campaigns">{{icon_components.campaigns(size="1rem")}} Campaigns</a></li>

    {% if user.world_user(obj) %}
    <li><a href="/{{obj.path}}/stories">{{icon_components.story(size="1rem")}} Stories</a></li>
    <li><a href="/{{obj.path}}/journal">{{icon_components.journal(size="1rem")}} Journal</a></li>
    {% endif %}

    <!-- divider here -->

    <li><a href="/{{obj.path}}/map">{{icon_components.map(size="1rem")}} Map</a></li>
    <li><a href="/{{obj.path}}/players">{{icon_components.players(size="1rem")}} Players</a></li>
    <!-- <li><a href="/{{obj.path}}/jobs">{{icon_components.jobs(size="1rem")}} Job Board</a></li> -->


    {% if user.world_user(obj) %}
    <li><a href="/{{obj.path}}/managescreens">{{icon_components.gmscreenmanage(size="1rem")}} GM Screen Manager</a></li>
    {% endif %}
{%- endmacro %}

{% macro menu_org(user, obj) -%}
<ul class="menu__list">
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/details" hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/details">
            <div class="row">
                <div id='menu-details-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.details(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-details-anchor', {
                        content: 'Details',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Details</span>
                </div>
            </div>
        </a>
    </li>
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/history"
           hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/history">
            <div class="row">
                <div id='menu-history-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.history(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-history-anchor', {
                        content: 'History',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>History</span>
                </div>
            </div>
        </a>
    </li>
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/timeline"
           hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/timeline">
            <div class="row">
                <div id='menu-timeline-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.timeline(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-timeline-anchor', {
                        content: 'Timeline',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Timeline</span>
                </div>
            </div>
        </a>
    </li>
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/campaigns"
           hx-target="#page-content"
           hx-indicator="#request-indicator"
           hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/campaigns">
            <div class="row">
                <div id='menu-campaigns-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.campaigns(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-campaigns-anchor', {
                        content: 'Campaigns',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Campaigns</span>
                </div>
            </div>
        </a>
    </li>
    {% if user.world_user(obj) %}
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/stories"
           hx-target="#page-content"
           hx-indicator="#request-indicator"
           hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/stories">
            <div class="row">
                <div id='menu-stories-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.story(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-stories-anchor', {
                        content: 'Stories',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Stories</span>
                </div>
            </div>
        </a>
    </li>
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/journal" hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/journal">
            <div class="row">
                <div id='menu-journal-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.journal(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-journal-anchor', {
                        content: 'Journal',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Journal</span>
                </div>
            </div>
        </a>
    </li>
    {% endif %}
</ul>
<p class="menu__divider"></p>
<ul class="menu__list">
    <li>
        <a href="" class="menu-anchor" hx-get="/api/{{obj.path}}/map"
           hx-target="#page-content" hx-indicator="#request-indicator"
           hx-swap="innerHTML show:#page-content:top" hx-push-url="/{{obj.path}}/map">
            <div class="row">
                <div id='menu-map-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.map(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-map-anchor', {
                        content: 'Map',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Map</span>
                </div>
            </div>
        </a>
    </li>
    <li>
        <a href="" class="menu-anchor" hx-get="/api/{{obj.path}}/players" hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML"
           hx-push-url=" /{{obj.path}}/players">
            <div class="row">
                <div id="menu-players-anchor" class="column is-3 is-mobile-shrink">
                    {{icon_components.players(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-players-anchor', {
                        content: 'Players',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',
                    });
                </script>
                <div class="column is-9 is-mobile-9 slide-it-in is-hidden menu-anchor-text">
                    <span>Players</span>
                </div>
            </div>
        </a>
    </li>
    <li>
        <a href="" class="menu-anchor"
           hx-get="/api/{{obj.path}}/jobs" hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
           hx-push-url="/{{obj.path}}/jobs">
            <div class="row">
                <div id='menu-jobs-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.jobs(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-jobs-anchor', {
                        content: 'Jobs',
                        placement: 'right',
                        arrow: false,
                        animation: 'perspective-extreme',
                    });
                </script>
                <div
                     class="column is-9 is-mobile-9 is-hidden slide-it-in menu-anchor-text">
                    <span>Job Board</span>
                </div>
            </div>
        </a>
    </li>
    {% if user.world_user(obj) %}
    <li>
        <a href="" class="menu-anchor" hx-post="/api/{{obj.path}}/managescreens"
           hx-target="#page-content"
           hx-indicator="#request-indicator" hx-swap="innerHTML"
           hx-push-url="/{{obj.path}}/managescreens">
            <div class="row">
                <div id='menu-manage-screens-anchor' class="column is-3 is-mobile-shrink">
                    {{icon_components.gmscreenmanage(size="1rem")}}
                </div>
                <script>
                    tippy('#menu-manage-screens-anchor', {
                        content: 'Manage Screens',
                        placement: 'right',
                        allowHTML: true,
                        arrow: false,
                        animation: 'perspective-extreme',

                    });
                </script>
                <div class="column is-9 is-mobile-9 slide-it-in is-hidden menu-anchor-text">
                    <span>GM Screen Manager</span>
                </div>
            </div>

        </a>
    </li>
    {% endif %}
</ul>
{%- endmacro %}


{% macro history(user, obj) -%}
{{history_components.history(user, obj)}}
{%- endmacro %}


{% macro details(user, obj) -%}
{{details_components.details(user, obj)}}
{%- endmacro %}


{% macro gmnotes(user, obj) -%}
<div id="gmnotes" lass="panel has-bg-dark generated-text-darkbg">
    <h3 class='has-text-center'>GM Notes</h3>
    <div class="row">
        <div class="column is-full">
            <div class="panel has-text-light">
                {{obj.description_summary | safe}}
            </div>
        </div>
        <div class="column is-full">
            <h5>Rumors</h5>
            <div class="panel has-text-light">
                <ul>
                    {% for sd in obj.rumors %}
                    <li>{{ sd | safe }}
                        <hr>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <h2 class='has-text-center' id='manage-stories'>Stories</h2>
    <ul class="has-no-list-style">
        {% for story in obj.stories %}
        <li>
            <h5>{{story.name}}</h5>{{story | safe}}
        </li>
        {% endfor %}
    </ul>
</div>
{%- endmacro %}


{% macro info(user, obj) -%}
{% if obj.current_date %}
<div class="row">
    <div class="column is-full">
        <h3 class="has-text-dark-grey has-text-center">
            Present Date:
            {{obj.current_date}}
        </h3>
    </div>
</div>
{% endif %}
<hr>
<h2 class='has-text-center' id='manage-factions'>Faction Control</h2>
<div class="row">
    {% for region in obj.regions %}
    <div class="column is-2">
        <div class="panel has-bg-screen is-full">
            {{display_components.object_display(region, type=False) | safe }}
            <h6 class="has-text-white has-text-center">
                {{(region.owner and region.owner.name) or "Unknown"}}
            </h6>
        </div>
    </div>
    {% endfor %}
</div>
{%- endmacro %}


{% macro timeline(user, obj)%}
{{timeline_components.timeline(user, obj)}}
{%- endmacro %}


{% macro journal(user, obj)%}
{{journal_components.journal(user, obj)}}
{%- endmacro %}


{% macro stories(user, obj)%}
<div id='stories-list'>
    {{stories_components.stories(user, obj)}}
</div>
{%- endmacro %}


{% macro campaigns(user, obj)%}
{% if user.world_user(obj)%}
<div class="row">
    <div class="column is-shrink is-end">
        <button class="button is-primary is-small" hx-post="/api/world/campaign/new"
                hx-target="#campaigns-list"
                hx-selector="#campaigns-list"
                hx-swap="outerHTML">
            {{icon_components.plus(size="1rem")}}
            New Campaign
        </button>
    </div>
</div>
{% endif %}
<div id='campaigns-list'>
    {{campaigns_components.campaigns(user, obj)}}
</div>
{%- endmacro %}

{% macro associations(user, obj, associations)%}
{{associations_components.associations(user, obj, associations)}}
{%- endmacro %}

{% macro map(user, obj)%}
{{map_components.map(user, obj)}}
{%- endmacro %}

{% macro jobs(user, obj)%}
{{jobs_components.jobs(user, obj)}}
{%- endmacro %}


{% macro players(user, obj) -%}
<title>{{obj.name}} - Players Panel</title>
<h2 class="has-text-dark">Players</h2>
{% for player in obj.players %}
<a href="/character/{{player.pk}}" style='text-decoration: none;'>
    <div class="panel has-bg-muted">
        <div class="row cards-container has-center">
            <div class="column  is-vertically-centered is-shrink">

                <div class="image is-medium is-thumbnail is-margin-center">
                    <img src="{{player.image.url(size='100')}}" loading="lazy" alt="{{player.name}}"
                         style="width:100%; height:100%;" />
                </div>
            </div>
            <div class="column">
                <h4 class="has-text-dark" style='text-decoration:underline;'>
                    {% if player.name %}
                    {{player.name}}
                    {% else %}
                    {{player.title}}
                    {% endif %}
                </h4>
                <div class="generated-text-lightbg">
                    {{player.backstory_summary | safe}}
                </div>
            </div>
        </div>
    </div>
</a>
<hr>
{% endfor %}
{%- endmacro %}


{% macro manage(user, obj) -%}
{{ manage_world_components.manage(user, obj) }}
{%- endmacro %}

{% macro managescreens(user, obj) -%}
{{ manage_screen_components.manage(user, obj) }}
{%- endmacro %}