{% import "shared/_display.html" as display %}

<!-- location display -->
{% macro info(user, obj) -%}
    <title>{{obj.name or obj.title}} - Details</title>
    <div id="character-info" class="grid-x grid-padding-x">
        <div class="cell small-12"><h2>Overview</h2></div>
        <div class="story cell small-12 medium-7">
            <p>{{obj.backstory | safe}}</p>

            <h3>History</h3>
            {{obj.history | safe}}
        </div>
        <div class="related-panel cell small-12 medium-4 large-offset-1">
            {{display.dsp_object_image(obj,'400')}}

            <table id="demographics">
                <tr><th>Name</th><td>{{obj.name or obj.title}}</td></tr>
                <tr><th>{{display.dsp_object_lifetime(obj,'start')}}</th><td>{{obj.start_date}}</td></tr>
                <tr><th>{{display.dsp_object_lifetime(obj,'end')}}</th><td>{{obj.end_date}}</td></tr>
                <tr><th>Type</th><td>{{ obj.location_type or "Unknown" }}</td></tr>
                <tr><th>Owner</th><td>{{ obj.owner.name or "Unknown"}}</td></tr>
            </table>

            <h2>Associations</h2>
            {{ display.dsp_all_associations(user, obj) }}
        </div>
    </div>
{%- endmacro %}

<!-- admin screen -->
{% macro manage_details(user, obj) -%}
<form hx-post="/api/manage/update"
      hx-swap="none" hx-trigger="input delay:1s, change">
    <div class="row">
        <div class="column">
            <h3>Location Type</h3>
            <input list="location_list" class="has-bg-light" type="text" id='location_type'
                   name="location_type" value='{{obj.location_type}}'>
            <datalist id="location_list">
                {% for ltype in obj.categories %}
                <option value="{{ltype}}" {% if obj.location_type==ltype %} selected {% endif %}>
                    {{ltype}}
                </option>
                {% endfor %}
            </datalist>
        </div>
    </div>
    <div class="column is-shrink">
        <h4>Owner</h4>
        <input class="has-bg-dark-grey" disabled id='owner' type="text" name="owner" value='TBD...'>
    </div>
</form>
{%- endmacro %}

{% macro dungeon(user, obj) -%}
<div class="row has-space-around">
    <div class="column is-3">
        <div class="image is-thumbnail">
            <img src="{{obj.map.url(250)}}" />
        </div>
        <div class="row has-space-around">
            <div class="column">
                <h4 class='has-text-center'>
                    {% if obj.name %}
                    {{obj.name}}
                    {% else %}
                    New {{obj.title}}
                    {% endif %}
                </h4>
            </div>
        </div>
    </div>
</div>
<hr>
<div class="row has-space-around">
    {% for dungeon in obj.dungeon %}
    <div class="column is-3">
        <a href="/{{dungeon.path}}">
            <div class="image is-thumbnail">
                <img src="{{dungeon.map.url(250)}}" />
            </div>
            <div class="row has-space-around">
                <div class="column">
                    <h4 class='has-text-center'>
                        {% if dungeon.name %}
                        {{dungeon.name}}
                        {% else %}
                        New {{dungeon.title}}
                        {% endif %}
                    </h4>
                </div>
            </div>
        </a>
    </div>
    {% for subdungeon in dungeon.dungeon %}
    {% if subdungeon not in obj.dungeon and subdungeon != obj %}
    <div class="column is-3">
        <a href="/{{subdungeon.path}}">
            <div class="image is-thumbnail">
                <img src="{{subdungeon.map.url(250)}}" />
            </div>
            <div class="row has-space-around">
                <div class="column">
                    <h4 class='has-text-center'>
                        {% if subdungeon.name %}
                        {{subdungeon.name}}
                        {% else %}
                        New {{subdungeon.title}}
                        {% endif %}
                    </h4>

                </div>
            </div>
        </a>
    </div>
    {% endif %}
    {% endfor %}
    {% endfor %}
</div>
{%- endmacro %}