{% import "shared/_display.html" as display_components %}
{% import "manage/_episode.html" as manage_episode_components %}
{% import "shared/_icons.html" as icon_components %}
{% import "shared/_details.html" as details_components %}
{% import "shared/_associations.html" as associations_components%}
{% import "shared/_title.html" as title_components %}
{% import "shared/_form.html" as form_components %}

{% macro index(user, obj) -%}
{{details(user, obj)}}
{%- endmacro %}

<!-- unique menu items for campaigns -->
{% macro menu(user, obj) -%}
<li>
    <a href=""
       hx-get="/api/{{obj.path}}/details" hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/details">
        <div class="grid-x">
            <div class="cell shrink">
                {{icon_components.details(size="1rem")}}
            </div>
            <div class="cell auto">
                <span>Details</span>
            </div>
        </div>
    </a>
</li>
{% if user.world_user(obj) %}
<li>
    <a href=""
       hx-get="/api/{{obj.path}}/gmnotes" hx-target="#page-content"
       hx-indicator="#request-indicator" hx-swap="innerHTML show:#page-content:top"
       hx-push-url="/{{obj.path}}/gmnotes">
        <div class="grid-x">
            <div class="cell shrink">
                {{icon_components.gamemaster(size="1rem")}}
            </div>
            <div class="cell auto">
                <span>GM Notes</span>
            </div>
        </div>
    </a>
</li>
{% endif %}
<li>
    <a href="/{{obj.path}}/graphic">
        <div class="grid-x">
            <div class="cell shrink">
                {{icon_components.drama(size="1rem")}}
            </div>
            <div class="cell auto">
                <span>Graphic</span>
            </div>
        </div>
    </a>
</li>
<li>
    <a href="/{{obj.campaign.path}}">
        <div class="grid-x">
            <div class="cell shrink">
                {{icon_components.campaigns(size="1rem")}}
            </div>
            <div class="cell auto">
                <span>Campaign</span>
            </div>
        </div>
    </a>
</li>
{%- endmacro %}

{% macro details(user, obj) -%}
<title>{{obj.name or obj.title}} - Details</title>
<div class="callout">
    <div id="episode-info" class="grid-x align-spaced">
        <div class="cell medium-4">
            {% if obj.image %}
            <div class="image">
                <img src="{{obj.image.url(size='large')}}" alt="{{obj.name}}" />
            </div>
            {% endif %}
        </div>
        <div class="cell">
            <div class="grid-x align-spaced">
                <div class="cell medium-4 text-center">
                    <h3 class='text-center'>Start</h3>
                    {{obj.start_date}}
                </div>
                <div class="cell medium-4 text-center">
                    <h3 class='text-center'>End</h3>
                    {{obj.end_date}}
                </div>
            </div>
        </div>
        <div class="cell">
            <div class="callout ">
                <h2 class='text-center'>Report</h2>
                <div>
                    {{obj.report | safe}}
                </div>
            </div>
        </div>
        <div class="cell">
            <div class="grid-x grid-margin-x align-center-middle">
                {% for event in obj.events %}
                <div class="cell medium-4">
                    <a href="/{{event.path}}">
                        <div class="callout ">
                            <h4 class='text-center'>{{event.name}}</h4>
                            {% if event.date %}
                            <div class='text-center'>
                                <strong>{{event.date}}</strong>
                            </div>
                            {% endif %}
                            {% if event.image %}
                            <img src='{{event.image.url()}}' alt='{{event.name}}'
                                 style='width:100%; height: auto; padding-bottom: 1rem;' />
                            {% endif %}
                            <div class='align-justify'>
                                {{event.summary | safe}}
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{%- endmacro %}

{% macro gmnotes(user, obj) -%}
<title>{{obj.name or obj.title}} - GM Notes</title>
{% if user.world_user(obj) %}
<div class="callout">
    <div id="episode-info" class="grid-x align-spaced">
        {% if obj.previous_episode and obj.previous_episode.summary %}
        <div class="cell auto">
            <div class="callout">
                <h4>Previous Episode</h4>
                {{obj.previous_episode.summary | safe }}
            </div>
        </div>
        {% endif %}
        <div class="cell medium-4">
            <div class="callout ">
                <h3 class='text-center'>Loot</h3>
                {{obj.loot | safe}}
            </div>
            <div class="callout ">
                <h3 class='text-center'>Current Active Hooks</h3>
                {{obj.hooks | safe}}
            </div>
        </div>
        <div class="cell">
            <h2 class='text-center'>Planning Notes</h2>
            <form hx-post="/api/episode/{{obj.pk}}/update"
                  hx-swap='none'
                  hx-trigger='input delay:1s, change'>
                <div class="callout ">
                    {{form_components.texteditor(user, obj, 'description')}}
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{%- endmacro %}

{% macro graphic(user, obj) -%}
<title>{{obj.name or obj.title}} - Details</title>
<div class="callout">
    <div id="episode-graphic" class="grid-x align-spaced">
        {% if user.world_user(obj) %}
        <div class="cell shrink ">
            <button class="button"
                    hx-post="/api/{{obj.path}}/graphic/generate"
                    hx-indicator="#request-indicator"
                    hx-push-url="/{{obj.path}}/graphic">
                Generate New Graphic
            </button>
        </div>
        {% endif %}
        <div class=" cell medium-10">
            <div class="callout ">
                {% if obj.graphic %}
                <div class="image">
                    <img src="{{obj.graphic.url()}}" alt="{{obj.name}}" />
                </div>
                {% else %}
                <p>No graphic has been generated for this episode.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{%- endmacro %}

{% macro timeline(user, obj)%}

{{timeline_components.timeline(user, obj)}}
{%- endmacro %}

{% macro associations(user, obj, associations)%}
{{associations_components.associations(user, obj, associations)}}
{%- endmacro %}

{% macro manage(user, obj) -%}
{{ manage_episode_components.manage(user, obj) }}
{%- endmacro %}