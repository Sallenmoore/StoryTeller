{% import "shared/_display.html" as display %}
{% import "manage/_episode.html" as manage_episode_components %}
{% import "shared/_icons.html" as icon_components %}
{% import "shared/_details.html" as details_components %}
{% import "shared/_associations.html" as associations_components%}
{% import "shared/_title.html" as title_components %}

{% macro index(user, obj) -%}
    {{overview(user, obj)}}
{%- endmacro %}

<!-- unique menu items for campaigns -->
{% macro menu(user, obj) -%}
<ul class="menu__list">
    <li>
        <a href="/api/{{obj.path}}/details"> {{icon_components.details(size="1rem")}} Details</a>
    </li>
    <li>
        <a href="/{{obj.campaign.path}}">{{icon_components.campaigns(size="1rem")}} Campaign</a>
    </li>
</ul>
{%- endmacro %}


{% macro gmnotes(user, obj) -%}
<div id="gmnotes" lass="panel has-bg-dark generated-text-darkbg">
    <h3 class='has-text-center'>GM Notes</h3>
</div>
{%- endmacro %}

<!-- episode display -->
{% macro overview(user, obj) -%}
<title>{{obj.name or obj.title}} - Details</title>
<div id="episode-info" class="grid-x grid-padding-x">
    <div class="story cell small-12 medium-7">
        <p>{{obj.episode_report | safe}}</p>
    </div>

    <div class="related-panel cell small-12 medium-4 large-offset-1">
        {{ display.dsp_object_image(obj,'400') }}

        <table>
            <tr><th>Campaign</th><td><a href="/{{obj.campaign.path}}">{{obj.campaign.name}}</a></td></tr>
            <tr><th>Episode #</th><td>{{obj.episode_num}}</td></tr>
            <tr><th>Start Date</th><td>{{obj.start_date}}</td></tr>
            <tr><th>End Date</th><td>{{obj.end_date}}</td></tr>
        </table>

        {{ episode_selector(obj) }}

        <h2>Associations</h2>
        {{ display.dsp_all_associations(user, obj) }}


    </div>
</div>
{%- endmacro %}

{% macro episode_selector(obj) -%}
<script>
    function goToEpisode(el) {
        var episode_id = el.options[el.selectedIndex].value;
        window.location.href = '/episode/' + episode_id;
    }
</script>
<select id="episode-select" name="episodepk" onchange="goToEpisode(this);">
    <option value="">==Select Episode==</option>
    {% for ep in obj.campaign.episodes %}
    <option value="{{ep.pk}}" {%if obj.pk and
            ep.pk==obj.pk %} selected {% endif %}>
            {{ep.episode_num}}: {{ep.name}}
    </option>
    {% endfor %}
</select>
{%- endmacro %}


{% macro details(user, obj) -%}
{{title_components.object_title(user, obj)}}
{{details_components.details(user, obj)}}
{%- endmacro %}

{% macro associations(user, obj, associations)%}
{{title_components.object_title(user, obj)}}
{{associations_components.associations(user, obj, associations)}}
{%- endmacro %}

{% macro manage(user, obj) -%}
{{ manage_episode_components.manage(user, obj) }}
{%- endmacro %}