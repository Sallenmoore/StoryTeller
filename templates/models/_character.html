{% import "shared/_form.html" as form_components %}
{% import "shared/_display.html" as display_components %}
{% import "shared/_abilities.html" as abilities_components %}
{% import "shared/_icons.html" as icon_components %}

{% macro menu(user, obj) -%}
    <p>Character Menu</p>
{%- endmacro %}

{% macro info(user, obj) -%}
    <p>Character Info</p>

<title>{{obj.name or obj.title}} - Details</title>

<div id="character-info" class="grid-x grid-padding-x">
    <div class="cell small-12"><h1>{{obj.name or obj.title}}</h1></div>
    <div class="cell small-12"><h2>Character Overview</h2></div>
    <div class="story cell small-12 medium-7">
        <p>{{obj.backstory | safe}}</p>

        <h3>History</h3>
        {{obj.history | safe}}

        {% if obj.description %}
            <h3>Description</h3>
            <p>{{obj.description | safe}}</p>
        {% endif %}

        {% if obj.traits %}
            <h3>Traits</h3>
            <p>{{obj.traits}}</p>
        {% endif %}
        
        {% if obj.goal %}
            <h3>Goals and Secrets</h3>
            {{obj.goal | safe}}
        {% endif %}
    </div>
    <div class="related-panel cell small-12 medium-4 large-offset-1">
        {% if obj.image %}
            <img src="{{obj.image.url(size='large')}}" alt="{{obj.name}}" />
        {% endif %}

        {{demographics(user, obj)}}

        <h2>Associations</h2>
        {{ display_components.dsp_all_associations(user, obj) }}
    </div>
</div>


<div id="character-game" class="grid-x grid-padding-x">
    <div class="cell small-12">
        <h2>Game Info</h2>
        {{gm_notes(user, obj)}}
    </div>
    <div class="main-panel cell small-12 medium-8">
        {% if obj.abilities %}
            <h3>Abilities</h3>
            {{abilities_components.dsp_abilities(user, obj)}}
        {% endif %}
    </div>
    <div class="side-panel cell small-12 medium-4">
        {{stats(user, obj)}}
        {{skills(user, obj)}}
    </div>
</div>

{%- endmacro %}

{% macro manage_details(user, obj) -%}
    <p>Character Manage Details</p>
{%- endmacro %}

<!--
    ATTRITUBES UNIQUE TO MODEL
-->

<!-- display character demographics -->
{% macro demographics(user, obj) -%}
    <table id="demographics">
        <tr><th>Name</th><td>{{obj.name or obj.title}}</td></tr>
        <tr><th>Start Date</th><td>{{obj.start_date}}</td></tr>
        <tr><th>End Date</th><td>{{obj.end_date}}</td></tr>
        <tr><th>Age</th><td>{{ obj.age or "Unknown" }}</td></tr>
        <tr><th>Species</th><td>{{obj.species or "Unknown"}}</td></tr>
        <tr><th>Class</th><td>{{obj.archetype or "Unknown"}}</td></tr>
        <tr><th>Gender</th><td>{{obj.gender or "Unknown"}}</td></tr>
        <tr><th>Occupation</th><td>{{obj.occupation or "Unknown"}}</td></tr>
    </table>
{%- endmacro %}

<!-- display ability stats -->
{% macro stats(user, obj) -%}
    <h3>Stats</h3>
    <table>
        <tr>
            <th>STR</th>
            <th>DEX</th>
            <th>INT</th>
            <th>WIS</th>
            <th>CHA</th>
            <th>CON</th>
        </tr>
        <tr>
            <td>{{obj.strength}} ({{(obj.strength|int-10)//2}})</td>
            <td>{{obj.dexterity}} ({{(obj.dexterity|int-10)//2}})</td>
            <td>{{obj.intelligence}} ({{(obj.intelligence|int-10)//2}})</td>
            <td>{{obj.wisdom}} ({{(obj.wisdom|int-10)//2}})</td>
            <td>{{obj.charisma}} ({{(obj.charisma|int-10)//2}})</td>
            <td>{{obj.constitution}} ({{(obj.constitution|int-10)//2}})</td>
        </tr>
    </table>

    <table id="ac-hp">
        <tr><th>AC</th><td>{{obj.ac}}</td></tr>
        <tr><th>HP</th><td>{{obj.current_hitpoints}} / {{obj.hitpoints}}</td></tr>
    </table>
{%- endmacro %}

<!-- display special skills -->
{% macro skills(user, obj) -%}
    {% if obj.skills %}
        <h3>Skills</h3>
        <div class="grid-x grid-margin-x">
        {% for skill, val in obj.skills.items() %}
            <table class="cell auto"><tr><th>{{skill}}</th><td>{{val}}</td></tr></table>
        {% endfor %}
        </div>
    {%endif%}
{%- endmacro %}

<!-- display GM notes-->
{% macro gm_notes(user, obj) -%}
    <h3>GM Notes</h3>
    <table id="gm-notes">
        <tr><th>Look-A-Like</th><td>{{obj.lookalike | safe}}</td></tr>
        <tr><th>Voice</th><td>{{obj.voice_description | safe}}</td></tr>
        <tr><th>Hooks</th><td>
            {% for q in obj.quests %}
                {{ q.summary | safe }}
                <hr>
                {{ q.hook | safe }}
            {% endfor %}
        </td></tr>
        <tr><th>Rumors</th><td>
            {% for r in obj.rumors %}
                {{ r | safe }}
            {% endfor %}
        </td></tr>
    </table>
{%- endmacro %}