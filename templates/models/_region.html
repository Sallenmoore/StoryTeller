{% import "shared/_form.html" as form_components %}

{% macro info(user, obj) -%}
<div class="row">
    {% if obj.ruling_faction %}
    <div class="column is-full">
        <div class="panel is-small has-bg-dark-grey generated-text-darkbg">
            <h4 class='has-text-center has-text-muted'>Ruling Faction</h4>
            <h5>{{obj.ruling_faction.name}}</h5>
            {{obj.ruling_faction.backstory_summary | safe}}
        </div>
    </div>
    {% elif obj.factions %}
    <div class="column is-full">
        <h4 class='has-text-center has-text-dark'>Local Factions</h4>
        {% for faction in obj.factions %}
        <div class="panel is-small has-bg-dark-grey">
            <h5>{{faction.name}}</h5>
            {{faction.backstory_summary | safe}}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <div class="column is-full">
        <div class="card has-bg-light">
            <div class="card__header is-vertically-centered has-bg-secondary">
                <h3 class="has-text-muted">Culture</h3>
            </div>
            <div class="card__content has-bg-light">
                <p class="has-text-dark">{{obj.culture | safe}}</p>
            </div>
        </div>
    </div>
    <div class="column is-full">
        <div class="card has-bg-light">
            <div class="card__header is-vertically-centered has-bg-secondary">
                <h3 class="has-text-muted">Government</h3>
            </div>
            <div class="card__content has-bg-light">
                <p class="has-text-dark">{{obj.government | safe}}</p>
            </div>
        </div>
    </div>
    <div class="column is-full">
        <div class="card has-bg-light">
            <div class="card__header is-vertically-centered has-bg-secondary">
                <h3 class="has-text-muted">Religion</h3>
            </div>
            <div class="card__content has-bg-light">
                <p class="has-text-dark">{{obj.religion | safe}}</p>
            </div>
        </div>
    </div>
</div>
{%- endmacro %}

{% macro manage_details(user, obj) -%}
<form hx-post="/api/manage/update"
      hx-swap="none" hx-trigger="input delay:1s, change">
    <h3 class='has-text-center has-text-light'>Ruling Faction</h3>
    <div class="row">
        <div class="column is-full">
            <div class="panel is-small has-bg-light">
                <div class="is-select">
                    <select name='ruling_faction'>
                        <option value=''>=== Select a Faction ===</option>
                        {%for f in obj.world.factions %}
                        <option value='{{f.pk}}' {% if f==obj.owner %} selected {% endif %}>
                            {{f.name}}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        {% for faction in obj.factions %}
        <div class="column is-full">
            <div class="panel is-small has-bg-primary has-text-white">
                {{faction.backstory_summary | safe}}
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="row">
        <div class="column is-full">
            <h3 class="has-text-screen">Culture</h3>
            {{form_components.texteditor(user, obj, "culture")}}
        </div>
        <div class="column is-full">
            <h3 class="has-text-screen">Government</h3>
            {{form_components.texteditor(user, obj, "government")}}
        </div>
        <div class="column is-full">
            <h3 class="has-text-screen">Religion</h3>
            {{form_components.texteditor(user, obj, "religion")}}
        </div>
    </div>
</form>
{%- endmacro %}