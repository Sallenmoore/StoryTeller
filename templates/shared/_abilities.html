{% import "shared/_form.html" as form_components %}
{% import "shared/_icons.html" as icon_components %}

{% macro abilities(user, obj, abilities=None) -%}
<div class="callout">
    <h3 class=" text-center" style='padding: 0.25rem;'>Abilities</h3>
    {% set ability_list = abilities or obj.abilities %}
    <ul class="accordion abilities" data-accordion data-multi-expand="true"
        data-allow-all-closed="true">
        {%for ability in ability_list%}
        <li class="accordion-item" data-accordion-item>
            <a href="#" class="accordion-title">{{ability.name}}</a>
            <div class="accordion-content" data-tab-content>
                <table class="ability">
                    <tr>
                        <th>Description</th>
                        <td>{{ability.description | safe}}</td>
                    </tr>
                    <tr>
                        <th>Roll Mechanics</th>
                        <td>{{ability.dice_roll or "N/A"}}</td>
                    </tr>
                    <tr>
                        <th>Effects</th>
                        <td>{{ability.effects or "N/A"}}</td>
                    </tr>
                    <tr>
                        <th>Duration</th>
                        <td>{{ability.duration or "N/A"}}</td>
                    </tr>
                </table>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{%- endmacro %}


{% macro edit_abilities(user, obj, abilities=None) -%}
{% set ability_list = abilities or obj.abilities %}
<div class="callout">
    <div class="grid-x">
        <div id="model-abilities-container" class="cell">
            <h3 class='text-center'>Abilities</h3>
            <div class="cell shrink">
                <button type="button" class="button small"
                        hx-post='/api/manage/details/add/listitem/ability'
                        hx-target='#ability-item-list'
                        hx-select='#ability-item-list'
                        hx-swap='outerHTML' hx-trigger="click consume">
                    {{icon_components.plus(size="1rem")}}
                    New Ability
                </button>
            </div>
            <div class="grid-x" id='ability-item-list'>
                {% for ability in ability_list %}
                <div class="cell medium-6" style='position:relative;'>
                    <div class="callout bg-secondary">
                        <h4 class=' text-center'
                            onclick='this.nextElementSibling.classList.toggle("is-hidden")'>
                            {{ability.name}}
                        </h4>
                        <div id="model-abilities" class="grid-x is-hidden">
                            <div class="cell medium-4 ">
                                <label for="ability-name">Name</label>
                                <input name='abilities[].name' type="text"
                                       value="{{ability.name}}">
                            </div>
                            <div class="cell medium-4 ">
                                <label for="ability-name">Action Type</label>
                                <div class="select">
                                    <select name='abilities[].action'
                                            value="{{ability.action}}">
                                        {%for a in ["main action", "bonus action", "reaction",
                                        "free action",
                                        "passive"] %}
                                        <option value="{{a}}" {% if ability.action==a %} selected {%
                                                endif %}>{{a}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="cell medium-4 ">
                                <label for="ability-duration">Duration</label>
                                <input name='abilities[].duration' type="text"
                                       value="{{ability.duration}}">
                            </div>
                            <div class="cell medium-6">
                                <label for="ability-dice-roll">Dice Roll</label>
                                <textarea
                                          class="has-bg-white"
                                          name='abilities[].dice_roll'>{{ability.dice_roll}}</textarea>
                            </div>
                            <div class="cell medium-6">
                                <label for="ability-effects">Effects</label>
                                <textarea class="has-bg-white"
                                          name='abilities[].effects'>{{ability.effects}}</textarea>
                            </div>
                            <div class="cell ">
                                {{form_components.texteditor(user, ability, "description", content=ability.description, name="abilities[].description")}}
                            </div>
                        </div>
                    </div>
                    <a
                       style='position:absolute; top:5px; right:5px;'
                       hx-post='/api/manage/details/ability/{{ability.pk}}/remove'
                       hx-target='closest .cell'
                       hx-swap='delete' hx-trigger="click consume">
                        {{icon_components.delete(size="1rem")}}
                    </a>
                </div>
                <hr>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endmacro%}