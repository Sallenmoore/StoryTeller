{% import "components/_form.html" as form_components %}
{% import "components/_elements.html" as model_components %}
{% import "components/_elements.html" as element %}

{% macro campaigns(user, obj, campaign_list, campaign=None, episode=None) -%}
<title>{{obj.name | title}} - Manage Campaign</title>
{% set campaign = campaign or obj.get_world().current_campaign %}
{% set episode = episode or campaign.current_episode %}
<h2 class='has-text-dark' id='manage-campaigns'>
    Manage Campaigns
</h2>
<div id="world-campaign-details" class="raise-it">
    <div class="row">
        <div class="column">
            <select class="has-bg-muted" name="campaignpk"
                    hx-post="/api/campaign/manager"
                    hx-target="#page-content" hx-trigger='change'>
                <option value="">=== Select Campaign ===</option>
                {% for cmp in campaign_list %}
                <option class="has-text-dark" value="{{cmp.pk}}" {% if campaign.pk==cmp.pk %}
                        selected {% endif %}>
                    {{cmp.name}} :
                    {% if cmp.start_date %}{{cmp.start_date.datestr()}}{% else %}Unknown{% endif %}
                    -
                    {% if cmp.end_date %}{{cmp.end_date.datestr()}}{% else %}Unknown{% endif %}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="column is-shrink is-end">
            <button class="button is-primary is-small" hx-post="/api/campaign/new"
                    hx-target="#world-campaign-details" hx-swap="outerHTML">
                <iconify-icon icon="mdi:plus" width="1rem" height="1rem"></iconify-icon>
                New Campaign
            </button>
        </div>
    </div>
    {% if campaign %}
    <div class="tabs has-border">
        <ul class="campaign_tablist tabs__list has-centered ">
            <li class='has-text-dark'>
                <a onclick='campaign_manage_tabs("#campaign-details-container");'>
                    Campaign Details
                </a>
            </li>
            <li class="is-active has-text-dark">
                <a onclick='campaign_manage_tabs("#episode-details-container");'>
                    Episode Details
                </a>
            </li>
        </ul>
        <div class="row">
            <div id='campaign-details-container' class="column is-full campaign_tabs tabs__content">
                {{campaign_details(user, obj, campaign)}}
            </div>
            <div id="episode-details-container"
                 class="column is-full campaign_tabs tabs__content is-open">
                <h3>Episode Select</h3>
                <div class="row">
                    <div class="column">
                        {% if campaign and campaign.sessions %}
                        <select id="episode-select" class="has-bg-muted" name="sessionpk"
                                hx-post="/api/campaign/{{campaign.pk}}/session/manage"
                                hx-target="#campaign-episode-container"
                                hx-select="#episode-details"
                                hx-trigger='change' hx-indicator='#request-indicator'>
                            <option value="">==Select Session==</option>
                            {% for ep in campaign.sessions %}
                            <option value="{{ep.pk}}" {%if episode and
                                    ep.pk==episode.pk %} selected {% endif %}>
                                {{ep.name}}:
                                {% if ep.start_date and ep.start_date.year
                                %}{{ep.start_date.datestr()}}{% else %}Unknown{% endif %}
                                -
                                {% if ep.end_date and ep.end_date.year %}{{ep.end_date.datestr()}}{%
                                else %}Unknown{% endif %}
                            </option>
                            {% endfor %}
                        </select>
                        {% endif %}
                    </div>
                    <div class="column is-shrink is-end">
                        <button class="button is-primary is-small"
                                hx-post="/api/campaign/{{campaign.pk}}/session/new"
                                hx-target="#world-campaign-details"
                                hx-select="#world-campaign-details"
                                hx-swap="outerHTML">
                            <iconify-icon icon="mdi:plus" width="1rem"
                                          height="1rem"></iconify-icon>
                            New
                            Session
                        </button>
                    </div>
                </div>
                <div class="row fade-it-in" id='campaign-episode-container'>
                    <div id='episode-details' class="column">
                        {% if episode %}
                        {{episode_details(user, obj, episode)}}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function campaign_manage_tabs(tab_id) {
            const tabs = document.querySelectorAll('.campaign_tablist li');
            tabs.forEach(tab => {
                tab.addEventListener('click', function () {
                    tabs.forEach(t => t.classList.remove('is-active'));
                    this.classList.add('is-active');
                });
            });
            const tabcontent = document.querySelectorAll('.campaign_tabs');
            tabcontent.forEach(t => t.classList.remove('is-open'));
            htmx.find(tab_id).classList.add('is-open');
        };
    </script>
    {% endif %}
</div>
{%- endmacro %}

{% macro campaign_details(user, obj, campaign) -%}
<div class="panel has-bg-screen">
    <div class="row has-space-around">
        <div class="column is-shrink">
            {% if campaign.start_date %}
            <h5>Began: {{campaign.start_date.datestr()}}</h5>
            {% endif %}
        </div>
        <div class="column is-shrink">
            {% if campaign.end_date %}
            <h5>Ended: {{campaign.end_date.datestr()}}</h5>
            {% endif %}
        </div>
    </div>
</div>
<div class="panel has-bg-muted has-text-dark" style='position:relative;'>
    {{campaign.summary | safe}}
    <div style='position: absolute; bottom:0px; right:0px;'>
        <div class="row">
            <div class="column">
                <button class='button is-small' class="button is-primary"
                        hx-post="/task/generate/campaign/{{campaign.pk}}/summary"
                        hx-target='closest .column'>
                    Update Summary
                </button>
            </div>
        </div>
    </div>
</div>
<form hx-post="/api/campaign/{{campaign.pk}}/update" hx-swap='none'
      hx-trigger='input delay:0.5s'>
    <div class="row has-space-between" id="current-campaign-name">
        <div class="column is-full has-text-secondary">
            <div class="row">
                <div class="column is-shrink is-vertically-centered">
                    <h4>Name</h4>
                </div>
                <div class="column is-vertically-centered">
                    <input class="has-bg-light" type="text" name="name"
                           value="{{campaign.name}}">
                </div>
                <div class="column is-vertically-centered is-shrink">
                    <h5>Set as Current Campaign
                    </h5>
                </div>
                <div class="column is-vertically-centered is-shrink">
                    <div class="is-switch">
                        <input type="checkbox" id="current-campaign-switch"
                               name="current_campaign"
                               {% if obj.current_campaign.pk==campaign.pk %} checked {%endif%}>
                        <label for="current-campaign-switch"></label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="row" id="current-campaign-description">
        <div class="column is-full has-text-secondary">
            <h3 class='has-text-center'>Description</h>
                {{form_components.texteditor(user, campaign, 'description')}}
        </div>
    </div>
</form>
<hr class='has-bg-primary'>
<div class="row" id='campaign-players'>
    <div class="column is-4">
        <h5>Add Player</h5>
        <div class="panel has-bg-muted">
            <div class="is-multiple-select">
                <select multiple
                        size="{{obj.get_players(exclude_campaign=campaign, count_only=True)}}"
                        name='players'
                        style='max-height: 20rem;'
                        hx-post="/api/campaign/{{campaign.pk}}/addplayer"
                        hx-target="#campaign-players" hx-select="#campaign-players"
                        hx-swap="outerHTML" hx-indicator='#request-indicator'>
                    {% for player in obj.get_players(exclude_campaign=campaign) %}
                    <option value='{{player.pk}}'
                            style='height:3rem; text-align: end; {% if player.image %} background: left / contain no-repeat url({{player.image.url(size=50)}});{% endif %} font: 1.25rem "Rosarivo", cursive;'>
                        {{player.name}}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="panel">
            <h3 class='has-text-center'> Players </h3>
            <div class="row has-space-around">
                {% for p in campaign.players %}
                <div class="column is-4 has-text-center">
                    {{model_components.object_display(p)}}
                    <a
                       hx-post="/api/campaign/{{campaign.pk}}/removeplayer/{{p.pk}}"
                       hx-target="#campaign-players" hx-select="#campaign-players"
                       hx-swap="outerHTML" hx-indicator=' #request-indicator'
                       hx-confirm="Are you sure you want to remove this player from the campaign?">
                        <iconify-icon icon="mdi:remove" width="1rem"></iconify-icon>
                    </a>
                </div>
                {% endfor%}
            </div>
        </div>
    </div>
</div>
<div class="section is-small">
    <div class="panel">
        <h2 class='has-text-center'> Associations </h2>
        {% for title in ['Locations', 'POIs', 'Characters', 'Creatures', 'Items', 'Factions'] %}
        {% set obj_key = title | lower %}
        {% if campaign[obj_key] %}
        <hr class='has-bg-muted'>
        <h3 class='has-text-center'> {{title}} </h3>
        <div class="row has-space-around" id="session-encounters">
            {% for a in campaign[obj_key] %}
            <div class="column is-3 episode-association-entry">
                <div class="row">
                    <div class="column is-full">
                        {{element.object_display(a)}}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>
<hr class='has-bg-muted'>
<div class="row">
    <div class="column is-shrink is-center">
        <a hx-post="/api/campaign/{{campaign.pk}}/delete"
           hx-target="#page-content"
           hx-confirm='Are you sure you want to delete this campaign?'>
            <iconify-icon icon="mdi:trash-outline" width="1.5rem"></iconify-icon>
        </a>
    </div>
</div>
{%- endmacro %}

{% macro episode_details(user, obj, episode) -%}
<div class="panel has-bg-muted has-text-dark" style='position:relative;'>
    {{episode.summary | safe}}
    <div style='position: absolute; bottom:0px; right:0px;'>
        <div class="row">
            <div class="column">
                <button class='button is-small' class="button is-primary"
                        hx-post="/task/generate/campaign/session/{{episode.pk}}/summary"
                        hx-target='closest .column'>
                    Update Summary
                </button>
            </div>
        </div>
    </div>
</div>
<form hx-post="/api/campaign/{{episode.campaign.pk}}/session/{{episode.pk}}/manage" hx-swap='none'
      hx-trigger='input delay:1s, change'>
    <div class="row">
        <div class="column is-6">
            <h4 class='has-text-center has-text-dark'>Name</h4>
            <input class="has-bg-light has-text-center" type="text" name="name"
                   value="{{episode.name}}">
        </div>
        <div class="column is-6">
            <h4 class='has-text-center has-text-dark'>Episode Number</h4>
            <input class="has-bg-light has-text-center" type="number" name="episode_num"
                   value="{{episode.episode_num}}">
        </div>
    </div>
    <div class="panel is-small has-bg-screen">
        <div class="row">
            <div class="column">
                <h5 class='has-text-primary has-text-center'>Start Date</h5>
                <div class="row">
                    <div class="column">
                        <h6>Day</h6>
                        <input class='has-bg-light' type="number" name="start_date.day"
                               value="{{episode.start_date.day}}">
                    </div>
                    <div class="column">
                        <h6>Month</h6>
                        <select class="has-bg-muted" name="start_date.month">
                            {% for month in obj.calendar.months %}
                            <option value="{{loop.index0}}" {% if
                                    episode.start_date['month']==loop.index0 %} selected {%endif%}>
                                {{month}}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="column">
                        <h6>Year</h6>
                        <input class='has-bg-light' type="number" name="start_date.year"
                               value="{{episode.start_date.year}}">
                    </div>
                </div>
            </div>
            <div class="column">
                <h5 class='has-text-primary  has-text-center'>End Date</h5>
                <div class="row">
                    <div class="column">
                        <h6>Day</h6>
                        <input class='has-bg-light' type="number" name="end_date.day"
                               value="{{episode.end_date.day}}">
                    </div>
                    <div class="column">
                        <h6>Month</h6>
                        <select class="has-bg-muted" name="end_date.month">
                            {% for month in obj.calendar.months %}
                            <option value="{{loop.index0}}" {% if
                                    episode.end_date['month']==loop.index0
                                    %} selected {%endif%}>
                                {{month}}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="column">
                        <h6>Year</h6>
                        <input class='has-bg-light' type="number" name="end_date.year"
                               value="{{episode.end_date.year}}">
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<hr class='has-bg-primary'>
<div class="tabs has-border">
    <ul class="episode_tablist tabs__list has-centered ">
        <li class="has-text-dark is-active">
            <a hx-post='/api/campaign/episode/{{episode.pk}}/associations'
               hx-target='#episode-manage-container'
               onclick="activeTab(this)">
                Associations
            </a>
        </li>
        <li class='has-text-dark'>
            <a hx-post='/api/campaign/episode/{{episode.pk}}/report'
               hx-target='#episode-manage-container'
               onclick="activeTab(this)">
                Episode Report
            </a>
        </li>
        <li class="has-text-dark">
            <a hx-post='/api/campaign/episode/{{episode.pk}}/event'
               hx-target='#episode-manage-container'
               onclick="activeTab(this)">
                Events
            </a>
        </li>
        <li class="has-text-dark">
            <a hx-post='/api/campaign/episode/{{episode.pk}}/gmplanner'
               hx-target='#episode-manage-container'
               onclick="activeTab(this)">
                GM Tools
            </a>
        </li>
    </ul>
    <script>
        function activeTab(elem) {
            for (x of elem.closest("ul").children) {
                x.classList.remove("is-active");
            }
            elem.closest("li").classList.add("is-active");
        }
    </script>
    <div class="row">
        <div id="episode-manage-container" class="column episode_tabs fade-it-in">
            {{episode_associations(user, obj, episode)}}
        </div>
    </div>
</div>
<hr class='has-bg-primary'>
<div class="row ">
    <div class="column is-end is-shrink">
        <button class="button is-light has-text-dark"
                hx-post="/api/campaign/session/{{episode.pk}}/delete"
                hx-target="#episode-details-container" hx-select="#episode-details-container"
                hx-swap="outerHTML"
                hx-confirm='Are you sure you want to delete this Episode?'>
            <iconify-icon icon="mdi:trash-outline" width="1rem"></iconify-icon>
        </button>
    </div>
</div>
{%- endmacro %}

{% macro episode_report(user, obj, episode, afilter=None) -%}
<div class="row">
    <div class="column">
        <hr>
        <h3 class="has-text-center">Report</h3>
        <form hx-post="/api/campaign/{{episode.campaign.pk}}/session/{{episode.pk}}/manage"
              hx-swap='none'
              hx-trigger='input delay:1s, change'>
            <div id="session-report-container" class="fade-it-in">
                {{form_components.texteditor(user, episode, 'session_report')}}
            </div>
        </form>
    </div>
</div>
{%- endmacro %}

{% macro episode_events(user, obj, episode, selected_scene=None, events=[]) -%}
<h3>Manage Events</h3>
<div class="row" id="episode-events">
    <div class="column fade-it-in">
        <div class="panel has-bg-screen">
            <h5 class='has-text-center'>Events</h5>
            {% for event in episode.events %}
            <div class="row event-tag">
                <div class="column is-vertically-centered">
                    <h4>{{event.obj.name}}</h4>
                </div>
                <div class="column is-shrink is-vertically-centered">
                    <div class="is-addon-group is-rounded">
                        <span class="tag is-light">
                            {{event.name}}
                        </span>
                        <span class="tag">
                            {{event}}
                        </span>
                    </div>
                </div>
                <div class="column is-shrink is-mobil-shrink is-vertically-centered">
                    <a hx-post="/api/timeline/event/{{event.pk}}/delete"
                       hx-target="closest .event-tag" hx-swap="delete">
                        <iconify-icon icon="mdi:remove"
                                      width="1rem">
                        </iconify-icon>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{%- endmacro %}

{% macro episode_associations(user, obj, episode, afilter=None) -%}
<div id="episode-associations" class="row">
    <div class="column fade-it-in">
        <h3 class="has-text-center">Associations</h3>
        <hr>
        <h6>Add...</h6>
        <div class="row has-space-around">
            <div class="column is-shrink">
                <button class='button is-primary is-small'
                        hx-post='/api/campaign/episode/{{episode.pk}}/associations/add/campaignassociations'
                        hx-target="#episode-associations"
                        hx-select="#episode-associations"
                        hx-trigger='click consume'
                        hx-vals='{"sessionpk":"{{episode.pk}}"}'
                        hx-swap='outerHTML'>
                    All Campaign Associations
                </button>
            </div>
            <div class="column is-shrink">
                <button class='button is-primary is-small'
                        hx-post='/api/campaign/episode/{{episode.pk}}/associations/add/episodeassociations'
                        hx-target="#episode-associations"
                        hx-select="#episode-associations"
                        hx-trigger='click consume'
                        hx-vals='{"sessionpk":"{{episode.pk}}"}'
                        hx-swap='outerHTML'>
                    Previous Episode Associations
                </button>
            </div>
            <div class="column is-shrink">
                <button class='button is-primary is-small'
                        hx-post='/api/campaign/episode/{{episode.pk}}/associations/add/players'
                        hx-target="#episode-associations"
                        hx-select="#episode-associations"
                        hx-trigger='click consume'
                        hx-vals='{"sessionpk":"{{episode.pk}}"}'
                        hx-swap='outerHTML'>
                    players
                </button>
            </div>
            {% for model in obj._models %}
            <div class="column is-shrink">
                <button class='button is-small'
                        hx-post='/api/campaign/episode/{{episode.pk}}/associations/add/{{model | lower}}'
                        hx-target="#episode-associations"
                        hx-select="#episode-associations"
                        hx-trigger='click consume'
                        hx-vals='{"sessionpk":"{{episode.pk}}"}'
                        hx-swap='outerHTML'>
                    {{model}}
                </button>
            </div>
            {% endfor %}
        </div>
        <h6>Add by Search</h6>
        <div class="has-dropdown" style="width: 100%;">
            <input class="has-bg-light" autocomplete="off" type="search" name="query"
                   style="border-bottom: solid #000;"
                   hx-post="/api/campaign/episode/{{episode.pk}}/associations/add/search"
                   hx-target="#episode-new-associations-list"
                   hx-trigger="input changed delay:500ms consume"
                   hx-on:input="this.value.length < 3 ? this.closest('.has-dropdown').classList.remove('is-active'):this.closest('.has-dropdown').classList.add('is-active')">
            <ul class="dropdown has-bg-light" id="episode-new-associations-list">
            </ul>
        </div>
        <hr>
        <div class="panel has-bg-screen">
            <section class='section is-small'>
                <div class="row">
                    <div class="column is-shrink">
                        <h5>Filter by</h5>
                    </div>
                    <div class="column is-half is-centered">
                        <div class="select">
                            <select class='has-bg-muted' name="filter"
                                    hx-get="/api/campaign/episode/{{episode.pk}}/associations"
                                    hx-trigger="change" hx-indicator='#request-indicator'
                                    hx-target="#episode-associations">
                                <option value="">All</option>
                                {% for model in obj._models %}
                                <option value="{{model}}" {% if afilter==model %} selected {% endif
                                        %}>
                                    {{obj.get_title(model)}}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </section>
            {% if episode.locations %}
            {{ episode_association_display(user, obj, episode, episode.locations, "Locations") }}
            {% endif %}
            {% if episode.pois %}
            {{ episode_association_display(user, obj, episode, episode.pois, "POIs") }}
            {% endif %}
            {% if episode.characters %}
            {{ episode_association_display(user, obj, episode, episode.characters, "Characters") }}
            {% endif %}
            {% if episode.creatures %}
            {{ episode_association_display(user, obj, episode, episode.creatures, "Creatures") }}
            {% endif %}
            {% if episode.items %}
            {{ episode_association_display(user, obj, episode, episode.items, "Items") }}
            {% endif %}
            {% if episode.factions %}
            {{ episode_association_display(user, obj, episode, episode.factions, "Factions") }}
            {% endif %}
            {% if episode.cities %}
            {{ episode_association_display(user, obj, episode, episode.cities, "Cities") }}
            {% endif %}
            {% if episode.regions %}
            {{ episode_association_display(user, obj, episode, episode.regions, "Regions") }}
            {% endif %}
            {% if episode.encounters %}
            {{ episode_association_display(user, obj, episode, episode.encounters, "Encounters") }}
            {% endif %}
        </div>
    </div>
</div>
{%- endmacro %}



{% macro episode_association_display(user, obj, episode, children, title) -%}
<h3 class='has-text-center'> {{title}} </h3>
<hr class='has-bg-muted'>
<div class="row">
    {% for a in children %}
    <div class="column is-3 is-mobile-6 episode-association-entry fade-it-in">
        <div class="row">
            <div class="column is-full">
                {{element.object_display(a)}}
            </div>
            <div class="column is-full">
                <div class="row has-centered">
                    <div class="column is-shrink">
                        <a href="/{{a.path}}"
                           target='_blank'>
                            <iconify-icon icon="akar-icons:link-out"
                                          width="1rem"></iconify-icon>
                        </a>
                    </div>
                    {% if title in ['POIs', 'Locations'] %}
                    <div class="column is-shrink">
                        <a hx-post="/api/campaign/episode/{{episode.pk}}/associations/add/{{a.path}}"
                           hx-target="#episode-associations"
                           hx-select="#episode-associations"
                           hx-swap="outerHTML"
                           hx-vals='{"subobjects": true}'>
                            <iconify-icon icon="arcticons:connect-you" width="1rem"
                                          height="1rem"></iconify-icon>
                        </a>
                    </div>
                    {% endif %}
                    {% if title in ['Items', 'Creatures', 'Characters'] %}
                    <div class="column is-shrink">
                        <a href="/{{a.path}}/card"
                           target='_blank'>
                            <iconify-icon icon="icon-park-outline:id-card-v"
                                          width="1rem"></iconify-icon>
                        </a>
                    </div>
                    {% endif %}
                    <div class="column is-shrink is-vertically-centered">
                        <a hx-post="/api/campaign/episode/{{episode.pk}}/association/{{a.path}}/delete"
                           hx-target="closest .episode-association-entry" hx-swap="delete"
                           hx-confirm="Are you sure you want to remove this association from the session?">
                            <iconify-icon icon="mdi:trash" width="1rem"></iconify-icon>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{%- endmacro %}



{% macro association_dropdown(user, obj, episode, objs=[]) -%}
{% for o in objs %}
<li class="dropdown__link has-bg-muted">
    <a hx-post="/api/campaign/episode/{{episode.pk}}/associations/add/{{o.path}}"
       hx-target='#episode-associations'
       hx-select='#episode-associations' hx-swap='outerHTML'
       onclick="this.closest('.has-dropdown').classList.remove('is-active')">
        <div class="row">
            <div class="column is-shrink">
                <div class="image is-tiny is-thumbnail" style="cursor: pointer">
                    {% if o.image %}
                    <img src="{{o.image.url(size=50)}}" alt="{{o.name}}" />
                    {% endif %}
                </div>
            </div>
            <div class="column">
                {{o.name}}
            </div>
        </div>
    </a>
</li>
{% endfor %}
{%- endmacro%}


{% macro episode_gmplanner(user, obj, episode) -%}
<div id='gm-practice-container'>
    <div class="row has-space-around">
        <div class="column is-3">
            <a class='button is-full has-bg-screen has-text-light-grey'
               href='/{{obj.get_world().path}}/manage_tabletop' target='_blank'>
                <iconify-icon icon="fluent-mdl2:manager-self-service"
                              width="2rem"></iconify-icon>
                <span>Table Manager</span>
            </a>
        </div>
        <div class="column is-3">
            <a class='button is-full has-bg-muted has-text-dark-grey'
               href='/map/{{episode.campaign.pk}}'
               target='_blank'>
                <iconify-icon icon="material-symbols:display-external-input"
                              width="1rem"
                              height="1rem"></iconify-icon>
                Table Display
            </a>
        </div>
    </div>
    <div class="row">
        <div class="column">
            <h3 class='has-text-center'>Planning Notes</h3>
            <form hx-post="/api/campaign/{{episode.campaign.pk}}/session/{{episode.pk}}/manage"
                  hx-swap='none'
                  hx-trigger='input delay:1s, change'>
                <div id="gm-session-notes-container" class="fade-it-in">
                    {{form_components.texteditor(user, episode, 'description')}}
                </div>
            </form>
        </div>
    </div>

    <div class='panel raise-it is-large has-bg-screen'>
        <div class="row has-space-around">
            <div class="column is-full">
                <hr class='has-bg-muted'>
                <h3 class='has-text-center'>GM Practice</h3>
                <div class='row'>
                    <div class='column is-shrink is-vertically-centered'>
                        <h5>GM Instructions</h5>
                    </div>
                    <div class='column'>
                        <textarea class='textarea has-bg-light is-full'
                                  name='gm_instructions'></textarea>
                    </div>
                    <div class='column is-shrink is-end'>
                        <button class='button'
                                hx-post='/api/campaign/session/{{episode.pk}}/gmpractice'
                                hx-target='#gm-practice-container'
                                hx-select='#gm-practice-container'
                                hx-swap='outerHTML'>
                            Send
                        </button>
                    </div>
                </div>
                <hr>
                <div class='row'>
                    {% for player in episode.players %}
                    <div class='column is-half'>
                        <div class='row'>
                            <div class='column is-shrink'>
                                <a href="/{{player.path}}">

                                    <div class="image is-medium is-thumbnail is-margin-center">
                                        {% if player.image %}
                                        <img src="{{player.image.url(size='100')}}"
                                             loading="lazy"
                                             alt="{{player.name}}"
                                             style="width:100%;" />
                                        {% endif %}
                                    </div>
                                    <h5 class='has-text-center has-text-dark'>
                                        {% if player.name %}
                                        {{player.name}}
                                        {% else %}
                                        {{player.title}}
                                        {% endif %}
                                    </h5>
                                </a>
                            </div>
                            <div class='column'>
                                <div class="panel has-bg-muted">
                                    <p>player response</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    </div>
</div>
{%- endmacro %}